<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>BBB I/O Panel</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 1rem; }
    section { margin: 1rem 0; padding: .5rem 1rem; border: 1px solid #ddd; border-radius: 8px; }
    pre { background: #f8f8f8; padding: .5rem; border-radius: 6px; max-width: 60rem; overflow:auto; }
    label { margin-right: .5rem; }
    button { margin-right: .5rem; }
  </style>
</head>
<body>
  <h1>GPIO Panel Control</h1>

  <section>
    <h3>Read input</h3>
    <label>Chip: <input id="rchip" value="gpiochip0"></label>
    <label>Line: <input id="rline" value="23"></label>
    <button onclick="readInput()">Read</button>
    <pre id="iread"></pre>
  </section>

  <section>
    <h3>Set output</h3>
    <label>Chip: <input id="wchip" value="gpiochip0"></label>
    <label>Line: <input id="wline" value="60"></label>
    <button onclick="setOut(1)">HIGH</button>
    <button onclick="setOut(0)">LOW</button>
    <pre id="owrite"></pre>
  </section>

  <section>
    <h3>Run job</h3>
    <select id="job">
      <option>01-power-mgnt/reboot</option>
      <option>01-power-mgnt/sync_reboot</option>
      <option>90-log-diag/dmesg_recent</option>
    </select>
    <button onclick="runJob()">Run</button>
    <pre id="jout"></pre>
  </section>

  <script>
  async function readInput() {
    const chip = document.getElementById('rchip').value;
    const line = document.getElementById('rline').value;
    const r = await fetch(`/api/gpio_read.cgi?chip=${encodeURIComponent(chip)}&line=${encodeURIComponent(line)}`);
    document.getElementById('iread').textContent = `HTTP ${r.status}\n` + await r.text();
  }
  async function setOut(val) {
    const chip = document.getElementById('wchip').value;
    const line = parseInt(document.getElementById('wline').value, 10);
    const r = await fetch(`/api/gpio_write.cgi`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ chip, line, value: val })
    });
    document.getElementById('owrite').textContent = `HTTP ${r.status}\n` + await r.text();
  }
  async function runJob() {
    const sel = document.getElementById('job').value;  // e.g., "01-power-mgnt/reboot"
    const [group, id] = sel.split('/', 2);             // split into group + id

    const r = await fetch(`/api/run_job.cgi`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ group, id })               // send both fields
    });

    let bodyText;
    try { bodyText = await r.text(); } catch(e) { bodyText = String(e); }
    document.getElementById('jout').textContent = `HTTP ${r.status}\n${bodyText}`;
  }
  </script>
</body>
</html>
